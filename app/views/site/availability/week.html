{% extends '../../layouts/layout.html' %}
{% from '../../components/subNavigation/subNavigation.njk' import subNavigation %}
{% from '../../includes/renderServicesTable.njk' import renderServicesTable %}

{% set pageName = week[0] | formatDate('d LLLL') ~ ' to ' ~ week[6] | formatDate('d LLLL yyyy') %}

{% block beforeContent %}
{{ backLink({
  href: '/site/' ~ site_id,
  text: 'Back to dashboard'
}) }}
{% endblock %}



{% block content %}
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">

      <span class="nhsuk-caption-l">{{ data.sites[site_id].name }}{{ firstOfTheMonth }}</span>
      <h1 class="nhsuk-heading-l">{{ pageName }}</h1>
      {{
        subNavigation({
          items: [
            {
              text: 'Day',
              href: '/site/' ~ site_id ~ '/availability/day',
              visuallyHiddenText: "â€™s availability"
            },
            {
              text: 'Week',
              href: '/site/' ~ site_id ~ '/availability/week',
              isCurrent: true,
              visuallyHiddenText: ' availability'
            },
            {
              text: 'Month',
              href: '/site/' ~ site_id ~ '/availability/month',
              visuallyHiddenText: ' availability'
            },
            {
              text: 'All',
              href: '/site/' ~ site_id ~ '/availability/all',
              visuallyHiddenText: ' availability'
            },
            {
              text: 'Add availability',
              href: '/site/' ~ site_id ~ '/create-availability/type-of-session',
              isPrimary: true
            }
          ]
        })
      }}

      {{ pagination({
        previous: {
          labelText: previousWeek.start | formatDate('d') ~ " to " ~ previousWeek.end | formatDate('d LLL'),
          href: "/site/"~site_id~"/availability/week?date="~previousWeek.start
        },
        next: {
          labelText: nextWeek.start | formatDate('d') ~ " to " ~ nextWeek.end | formatDate('d LLL'),
          href: "/site/"~site_id~"/availability/week?date="~nextWeek.start  
        }
      }) }}
    </div>
  </div>
  <ol class="nhsuk-grid-row app-panel-list">
  {% for day in week %}
  <li class="nhsuk-grid-column-full  app-panel-list__item">

    <div class="nhsuk-table__panel-with-heading-tab">
      <h2 class="nhsuk-table__heading-tab">{{ day | formatDate('cccc, d LLLL') }}</h2>
      {% if data.daily_availability[site_id][day] %}
       {{ renderServicesTable({
          date: day, 
          sessions: data.daily_availability[site_id][day].sessions,
          slots: slots,
          site_id: site_id,
          data: data,
          change: {
            type: 'session'
          }
        }) }}
      {% else %}
      <p>No availability</p>
      {% endif %}
    </div>

  </li>
  {% endfor %}
  </ol>
{% endblock %}